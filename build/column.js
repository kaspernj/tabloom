import { Animated, StyleSheet } from "react-native";
import { shapeComponent, ShapeComponent } from "set-state-compare/build/shape-component";
import React from "react";
import { RowContext } from "./row";
import { TableContext } from "./table";
import useEventEmitter from "ya-use-event-emitter";
import { v4 as uuidv4 } from "uuid";
export default React.memo(shapeComponent(class TableColumn extends ShapeComponent {
    id = uuidv4();
    position = null;
    setup() {
        const { style } = this.props;
        this.rowContext = React.useContext(RowContext);
        this.tableContext = React.useContext(TableContext);
        React.useMemo(() => {
            const { position } = this.rowContext.row.onColumnMount({
                column: this
            });
            this.position = position;
        }, []);
        React.useEffect(() => {
            return () => {
                this.rowContext.row.onColumnUnmount({
                    column: this
                });
            };
        }, []);
        this.headerData = React.useMemo(() => {
            const columnPositionInRow = Object.keys(this.rowContext.row.tt.columns).length - 1;
            const headers = Object.values(this.tableContext.table.tt.headers);
            const headerData = headers.find((headerData) => headerData.position === columnPositionInRow);
            return headerData;
        }, []);
        this.header = this.headerData.header;
        this.width = React.useMemo(() => new Animated.Value(this.headerData.width || 0), []);
        this.style = React.useMemo(() => {
            const resolvedStyle = { width: this.tt.width };
            if (typeof style == "function") {
                style({
                    column: this,
                    headerData: this.tt.headerData,
                    rowContext: this.tt.rowContext,
                    style: resolvedStyle,
                    tableContext: this.tt.tableContext
                });
            }
            else if (style) {
                Object.assign(resolvedStyle, StyleSheet.flatten(style));
            }
            return resolvedStyle;
        }, [style]);
        useEventEmitter(this.tableContext.events, `column-width-changed-${this.tt.header.id}`, this.tt.onColumnWidthChanged);
    }
    render() {
        const { children, style, ...restProps } = this.props;
        return (React.createElement(Animated.View, { style: this.tt.style, ...restProps }, children));
    }
    onColumnWidthChanged = ({ width }) => this.tt.width.setValue(width);
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbHVtbi5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFDakQsT0FBTyxFQUFDLGNBQWMsRUFBRSxjQUFjLEVBQUMsTUFBTSx5Q0FBeUMsQ0FBQTtBQUN0RixPQUFPLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDekIsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNoQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sU0FBUyxDQUFBO0FBQ3BDLE9BQU8sZUFBZSxNQUFNLHNCQUFzQixDQUFBO0FBQ2xELE9BQU8sRUFBQyxFQUFFLElBQUksTUFBTSxFQUFDLE1BQU0sTUFBTSxDQUFBO0FBRWpDLGVBQWUsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxXQUFZLFNBQVEsY0FBYztJQUMvRSxFQUFFLEdBQUcsTUFBTSxFQUFFLENBQUE7SUFDYixRQUFRLEdBQUcsSUFBSSxDQUFBO0lBRWYsS0FBSztRQUNILE1BQU0sRUFBQyxLQUFLLEVBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBRTFCLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUM5QyxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUE7UUFFbEQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUU7WUFDakIsTUFBTSxFQUFDLFFBQVEsRUFBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQztnQkFDbkQsTUFBTSxFQUFFLElBQUk7YUFDYixDQUFDLENBQUE7WUFFRixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUMxQixDQUFDLEVBQUUsRUFB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QUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtDQUNsRSxDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7QW5pbWF0ZWQsIFN0eWxlU2hlZXR9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudCwgU2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnRcIlxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQge1Jvd0NvbnRleHR9IGZyb20gXCIuL3Jvd1wiXG5pbXBvcnQge1RhYmxlQ29udGV4dH0gZnJvbSBcIi4vdGFibGVcIlxuaW1wb3J0IHVzZUV2ZW50RW1pdHRlciBmcm9tIFwieWEtdXNlLWV2ZW50LWVtaXR0ZXJcIlxuaW1wb3J0IHt2NCBhcyB1dWlkdjR9IGZyb20gXCJ1dWlkXCJcblxuZXhwb3J0IGRlZmF1bHQgUmVhY3QubWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBUYWJsZUNvbHVtbiBleHRlbmRzIFNoYXBlQ29tcG9uZW50IHtcbiAgaWQgPSB1dWlkdjQoKVxuICBwb3NpdGlvbiA9IG51bGxcblxuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7c3R5bGV9ID0gdGhpcy5wcm9wc1xuXG4gICAgdGhpcy5yb3dDb250ZXh0ID0gUmVhY3QudXNlQ29udGV4dChSb3dDb250ZXh0KVxuICAgIHRoaXMudGFibGVDb250ZXh0ID0gUmVhY3QudXNlQ29udGV4dChUYWJsZUNvbnRleHQpXG5cbiAgICBSZWFjdC51c2VNZW1vKCgpID0+IHtcbiAgICAgIGNvbnN0IHtwb3NpdGlvbn0gPSB0aGlzLnJvd0NvbnRleHQucm93Lm9uQ29sdW1uTW91bnQoe1xuICAgICAgICBjb2x1bW46IHRoaXNcbiAgICAgIH0pXG5cbiAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvblxuICAgIH0sIFtdKVxuXG4gICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIHRoaXMucm93Q29udGV4dC5yb3cub25Db2x1bW5Vbm1vdW50KHtcbiAgICAgICAgICBjb2x1bW46IHRoaXNcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9LCBbXSlcblxuICAgIHRoaXMuaGVhZGVyRGF0YSA9IFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgICAgY29uc3QgY29sdW1uUG9zaXRpb25JblJvdyA9IE9iamVjdC5rZXlzKHRoaXMucm93Q29udGV4dC5yb3cudHQuY29sdW1ucykubGVuZ3RoIC0gMVxuICAgICAgY29uc3QgaGVhZGVycyA9IE9iamVjdC52YWx1ZXModGhpcy50YWJsZUNvbnRleHQudGFibGUudHQuaGVhZGVycylcbiAgICAgIGNvbnN0IGhlYWRlckRhdGEgPSBoZWFkZXJzLmZpbmQoKGhlYWRlckRhdGEpID0+IGhlYWRlckRhdGEucG9zaXRpb24gPT09IGNvbHVtblBvc2l0aW9uSW5Sb3cpXG5cbiAgICAgIHJldHVybiBoZWFkZXJEYXRhXG4gICAgfSwgW10pXG4gICAgdGhpcy5oZWFkZXIgPSB0aGlzLmhlYWRlckRhdGEuaGVhZGVyXG4gICAgdGhpcy53aWR0aCA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gbmV3IEFuaW1hdGVkLlZhbHVlKHRoaXMuaGVhZGVyRGF0YS53aWR0aCB8fCAwKSwgW10pXG4gICAgdGhpcy5zdHlsZSA9IFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgICAgY29uc3QgcmVzb2x2ZWRTdHlsZSA9IHt3aWR0aDogdGhpcy50dC53aWR0aH1cblxuICAgICAgaWYgKHR5cGVvZiBzdHlsZSA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgc3R5bGUoe1xuICAgICAgICAgIGNvbHVtbjogdGhpcyxcbiAgICAgICAgICBoZWFkZXJEYXRhOiB0aGlzLnR0LmhlYWRlckRhdGEsXG4gICAgICAgICAgcm93Q29udGV4dDogdGhpcy50dC5yb3dDb250ZXh0LFxuICAgICAgICAgIHN0eWxlOiByZXNvbHZlZFN0eWxlLFxuICAgICAgICAgIHRhYmxlQ29udGV4dDogdGhpcy50dC50YWJsZUNvbnRleHRcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSBpZiAoc3R5bGUpIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyZXNvbHZlZFN0eWxlLCBTdHlsZVNoZWV0LmZsYXR0ZW4oc3R5bGUpKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzb2x2ZWRTdHlsZVxuICAgIH0sIFtzdHlsZV0pXG5cbiAgICB1c2VFdmVudEVtaXR0ZXIodGhpcy50YWJsZUNvbnRleHQuZXZlbnRzLCBgY29sdW1uLXdpZHRoLWNoYW5nZWQtJHt0aGlzLnR0LmhlYWRlci5pZH1gLCB0aGlzLnR0Lm9uQ29sdW1uV2lkdGhDaGFuZ2VkKVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtjaGlsZHJlbiwgc3R5bGUsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG5cbiAgICByZXR1cm4gKFxuICAgICAgPEFuaW1hdGVkLlZpZXcgc3R5bGU9e3RoaXMudHQuc3R5bGV9IHsuLi5yZXN0UHJvcHN9PlxuICAgICAgICB7Y2hpbGRyZW59XG4gICAgICA8L0FuaW1hdGVkLlZpZXc+XG4gICAgKVxuICB9XG5cbiAgb25Db2x1bW5XaWR0aENoYW5nZWQgPSAoe3dpZHRofSkgPT4gdGhpcy50dC53aWR0aC5zZXRWYWx1ZSh3aWR0aClcbn0pKVxuIl19