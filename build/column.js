import { Animated, StyleSheet } from "react-native";
import { shapeComponent, ShapeComponent } from "set-state-compare/build/shape-component";
import React from "react";
import { RowContext } from "./row";
import { TableContext } from "./table";
import useEventEmitter from "ya-use-event-emitter";
import { v4 as uuidv4 } from "uuid";
export default React.memo(shapeComponent(class TableColumn extends ShapeComponent {
    id = uuidv4();
    position = null;
    setup() {
        const { style } = this.props;
        this.rowContext = React.useContext(RowContext);
        this.tableContext = React.useContext(TableContext);
        React.useMemo(() => {
            const { position } = this.rowContext.row.onColumnMount({
                column: this
            });
            this.position = position;
        }, []);
        React.useEffect(() => {
            return () => {
                this.rowContext.row.onColumnUnmount({
                    column: this
                });
            };
        }, []);
        this.headerData = React.useMemo(() => {
            const columnPositionInRow = Object.keys(this.rowContext.row.tt.columns).length - 1;
            const headers = Object.values(this.tableContext.table.tt.headers);
            const headerData = headers.find((headerData) => headerData.position === columnPositionInRow);
            return headerData;
        }, []);
        this.header = this.headerData.header;
        this.width = React.useMemo(() => new Animated.Value(this.headerData.width || 0), []);
        this.style = React.useMemo(() => ({ width: this.tt.width }), []);
        React.useLayoutEffect(() => {
            if (typeof style == "function") {
                style({
                    column: this,
                    headerData: this.tt.headerData,
                    rowContext: this.tt.rowContext,
                    style: this.style,
                    tableContext: this.tt.tableContext
                });
            }
            else if (style) {
                Object.assign(this.style, StyleSheet.flatten(style));
            }
        }, [style]);
        useEventEmitter(this.tableContext.events, `column-width-changed-${this.tt.header.id}`, this.tt.onColumnWidthChanged);
    }
    render() {
        const { children, style, ...restProps } = this.props;
        return (React.createElement(Animated.View, { style: this.tt.style, ...restProps }, children));
    }
    onColumnWidthChanged = ({ width }) => this.tt.width.setValue(width);
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sdW1uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbHVtbi5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFDakQsT0FBTyxFQUFDLGNBQWMsRUFBRSxjQUFjLEVBQUMsTUFBTSx5Q0FBeUMsQ0FBQTtBQUN0RixPQUFPLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDekIsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNoQyxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sU0FBUyxDQUFBO0FBQ3BDLE9BQU8sZUFBZSxNQUFNLHNCQUFzQixDQUFBO0FBQ2xELE9BQU8sRUFBQyxFQUFFLElBQUksTUFBTSxFQUFDLE1BQU0sTUFBTSxDQUFBO0FBRWpDLGVBQWUsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxXQUFZLFNBQVEsY0FBYztJQUMvRSxFQUFFLEdBQUcsTUFBTSxFQUFFLENBQUE7SUFDYixRQUFRLEdBQUcsSUFBSSxDQUFBO0lBRWYsS0FBSztRQUNILE1BQU0sRUFBQyxLQUFLLEVBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBRTFCLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUM5QyxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUE7UUFFbEQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUU7WUFDakIsTUFBTSxFQUFDLFFBQVEsRUFBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQztnQkFDbkQsTUFBTSxFQUFFLElBQUk7YUFDYixDQUFDLENBQUE7WUFFRixJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUMxQixDQUFDLEVBQUUsRUFB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QyxLQUFLLEVBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFBO0NBQ2xFLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBbmltYXRlZCwgU3R5bGVTaGVldH0gZnJvbSBcInJlYWN0LW5hdGl2ZVwiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50LCBTaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudFwiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7Um93Q29udGV4dH0gZnJvbSBcIi4vcm93XCJcbmltcG9ydCB7VGFibGVDb250ZXh0fSBmcm9tIFwiLi90YWJsZVwiXG5pbXBvcnQgdXNlRXZlbnRFbWl0dGVyIGZyb20gXCJ5YS11c2UtZXZlbnQtZW1pdHRlclwiXG5pbXBvcnQge3Y0IGFzIHV1aWR2NH0gZnJvbSBcInV1aWRcIlxuXG5leHBvcnQgZGVmYXVsdCBSZWFjdC5tZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIFRhYmxlQ29sdW1uIGV4dGVuZHMgU2hhcGVDb21wb25lbnQge1xuICBpZCA9IHV1aWR2NCgpXG4gIHBvc2l0aW9uID0gbnVsbFxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHtzdHlsZX0gPSB0aGlzLnByb3BzXG5cbiAgICB0aGlzLnJvd0NvbnRleHQgPSBSZWFjdC51c2VDb250ZXh0KFJvd0NvbnRleHQpXG4gICAgdGhpcy50YWJsZUNvbnRleHQgPSBSZWFjdC51c2VDb250ZXh0KFRhYmxlQ29udGV4dClcblxuICAgIFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgICAgY29uc3Qge3Bvc2l0aW9ufSA9IHRoaXMucm93Q29udGV4dC5yb3cub25Db2x1bW5Nb3VudCh7XG4gICAgICAgIGNvbHVtbjogdGhpc1xuICAgICAgfSlcblxuICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uXG4gICAgfSwgW10pXG5cbiAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgdGhpcy5yb3dDb250ZXh0LnJvdy5vbkNvbHVtblVubW91bnQoe1xuICAgICAgICAgIGNvbHVtbjogdGhpc1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sIFtdKVxuXG4gICAgdGhpcy5oZWFkZXJEYXRhID0gUmVhY3QudXNlTWVtbygoKSA9PiB7XG4gICAgICBjb25zdCBjb2x1bW5Qb3NpdGlvbkluUm93ID0gT2JqZWN0LmtleXModGhpcy5yb3dDb250ZXh0LnJvdy50dC5jb2x1bW5zKS5sZW5ndGggLSAxXG4gICAgICBjb25zdCBoZWFkZXJzID0gT2JqZWN0LnZhbHVlcyh0aGlzLnRhYmxlQ29udGV4dC50YWJsZS50dC5oZWFkZXJzKVxuICAgICAgY29uc3QgaGVhZGVyRGF0YSA9IGhlYWRlcnMuZmluZCgoaGVhZGVyRGF0YSkgPT4gaGVhZGVyRGF0YS5wb3NpdGlvbiA9PT0gY29sdW1uUG9zaXRpb25JblJvdylcblxuICAgICAgcmV0dXJuIGhlYWRlckRhdGFcbiAgICB9LCBbXSlcbiAgICB0aGlzLmhlYWRlciA9IHRoaXMuaGVhZGVyRGF0YS5oZWFkZXJcbiAgICB0aGlzLndpZHRoID0gUmVhY3QudXNlTWVtbygoKSA9PiBuZXcgQW5pbWF0ZWQuVmFsdWUodGhpcy5oZWFkZXJEYXRhLndpZHRoIHx8IDApLCBbXSlcbiAgICB0aGlzLnN0eWxlID0gUmVhY3QudXNlTWVtbygoKSA9PiAoe3dpZHRoOiB0aGlzLnR0LndpZHRofSksIFtdKVxuXG4gICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHtcbiAgICAgIGlmICh0eXBlb2Ygc3R5bGUgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHN0eWxlKHtcbiAgICAgICAgICBjb2x1bW46IHRoaXMsXG4gICAgICAgICAgaGVhZGVyRGF0YTogdGhpcy50dC5oZWFkZXJEYXRhLFxuICAgICAgICAgIHJvd0NvbnRleHQ6IHRoaXMudHQucm93Q29udGV4dCxcbiAgICAgICAgICBzdHlsZTogdGhpcy5zdHlsZSxcbiAgICAgICAgICB0YWJsZUNvbnRleHQ6IHRoaXMudHQudGFibGVDb250ZXh0XG4gICAgICAgIH0pXG4gICAgICB9IGVsc2UgaWYgKHN0eWxlKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5zdHlsZSwgU3R5bGVTaGVldC5mbGF0dGVuKHN0eWxlKSlcbiAgICAgIH1cbiAgICB9LCBbc3R5bGVdKVxuXG4gICAgdXNlRXZlbnRFbWl0dGVyKHRoaXMudGFibGVDb250ZXh0LmV2ZW50cywgYGNvbHVtbi13aWR0aC1jaGFuZ2VkLSR7dGhpcy50dC5oZWFkZXIuaWR9YCwgdGhpcy50dC5vbkNvbHVtbldpZHRoQ2hhbmdlZClcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7Y2hpbGRyZW4sIHN0eWxlLCAuLi5yZXN0UHJvcHN9ID0gdGhpcy5wcm9wc1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlZC5WaWV3IHN0eWxlPXt0aGlzLnR0LnN0eWxlfSB7Li4ucmVzdFByb3BzfT5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgPC9BbmltYXRlZC5WaWV3PlxuICAgIClcbiAgfVxuXG4gIG9uQ29sdW1uV2lkdGhDaGFuZ2VkID0gKHt3aWR0aH0pID0+IHRoaXMudHQud2lkdGguc2V0VmFsdWUod2lkdGgpXG59KSlcbiJdfQ==