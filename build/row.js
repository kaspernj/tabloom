import { shapeComponent, ShapeComponent } from "set-state-compare/build/shape-component";
import { Animated } from "react-native";
import React from "react";
import { TableContext } from "./table";
import useEventEmitter from "ya-use-event-emitter";
import { v4 as uuidv4 } from "uuid";
const RowContext = React.createContext();
export { RowContext };
export default React.memo(shapeComponent(class TableRow extends ShapeComponent {
    columns = {};
    columnsCount = 0;
    id = uuidv4();
    position = null;
    setup() {
        this.tableContext = React.useContext(TableContext);
        this.rowContext = React.useMemo(() => ({
            row: this
        }), []);
        this.width = React.useMemo(() => new Animated.Value(this.tableContext.width || 0), []);
        useEventEmitter(this.tableContext.events, "table-width-changed", this.tt.onTableWidthChange);
        React.useMemo(() => {
            const { position } = this.tableContext.table.onMountRow({ row: this });
            this.position = position;
        }, []);
        React.useEffect(() => {
            return () => {
                this.tableContext.table.onUnmountRow({ row: this });
            };
        }, []);
    }
    render() {
        const { children, style, ...restProps } = this.props;
        const rowStyle = React.useMemo(() => {
            return Object.assign({ flexDirection: "row", width: this.tt.width }, style);
        }, [style]);
        return (React.createElement(RowContext.Provider, { value: this.tt.rowContext },
            React.createElement(Animated.View, { style: rowStyle, ...restProps }, children)));
    }
    onColumnMount({ column }) {
        const position = this.columnsCount;
        this.columnsCount++;
        this.columns[column.id] = {
            column,
            position
        };
        return { position };
    }
    onColumnUnmount({ column }) {
        delete this.columns[column.id];
        this.columnsCount--;
    }
    onTableWidthChange = ({ width }) => this.tt.width.setValue(width);
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm93LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3Jvdy5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLGNBQWMsRUFBRSxjQUFjLEVBQUMsTUFBTSx5Q0FBeUMsQ0FBQTtBQUN0RixPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQ3JDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUN6QixPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sU0FBUyxDQUFBO0FBQ3BDLE9BQU8sZUFBZSxNQUFNLHNCQUFzQixDQUFBO0FBQ2xELE9BQU8sRUFBQyxFQUFFLElBQUksTUFBTSxFQUFDLE1BQU0sTUFBTSxDQUFBO0FBRWpDLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxhQUFhLEVBQUUsQ0FBQTtBQUV4QyxPQUFPLEVBQUMsVUFBVSxFQUFDLENBQUE7QUFFbkIsZUFBZSxLQUFLLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLFFBQVMsU0FBUSxjQUFjO0lBQzVFLE9BQU8sR0FBRyxFQUFFLENBQUE7SUFDWixZQUFZLEdBQUcsQ0FBQyxDQUFBO0lBQ2hCLEVBQUUsR0FBRyxNQUFNLEVBQUUsQ0FBQTtJQUNiLFFBQVEsR0FBRyxJQUFJLENBQUE7SUFFZixLQUFLO1FBQ0gsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFBO1FBQ2xELElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQ3JDLEdBQUcsRUFBRSxJQUFJO1NBQ1YsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBQ1AsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtRQUV0RixlQUFlLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO1FBRTVGLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFO1lBQ2pCLE1BQU0sRUFBQyxRQUFRLEVBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsRUFBQyxHQUFHLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQTtZQUVsRSxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQTtRQUMxQixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFFTixLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUNuQixPQUFPLEdBQUcsRUFBRTtnQkFDVixJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBQyxHQUFHLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQTtZQUNuRCxDQUFDLENBQUE7UUFDSCxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFDUixDQUFDO0lBRUQsTUFBTTtRQUNKLE1BQU0sRUFBQyxRQUFRLEVBQUUsS0FBSyxFQUFFLEdBQUcsU0FBUyxFQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUNsRCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRTtZQUNsQyxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQ2xCLEVBQUMsYUFBYSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUMsRUFDNUMsS0FBSyxDQUNOLENBQUE7UUFDSCxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1FBRVgsT0FBTyxDQUNMLG9CQUFDLFVBQVUsQ0FBQyxRQUFRLElBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVTtZQUM1QyxvQkFBQyxRQUFRLENBQUMsSUFBSSxJQUFDLEtBQUssRUFBRSxRQUFRLEtBQU0sU0FBUyxJQUMxQyxRQUFRLENBQ0ssQ0FDSSxDQUN2QixDQUFBO0lBQ0gsQ0FBQztJQUVELGFBQWEsQ0FBQyxFQUFDLE1BQU0sRUFBQztRQUNwQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFBO1FBRWxDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtRQUNuQixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsR0FBRztZQUN4QixNQUFNO1lBQ04sUUFBUTtTQUNULENBQUE7UUFFRCxPQUFPLEVBQUMsUUFBUSxFQUFDLENBQUE7SUFDbkIsQ0FBQztJQUVELGVBQWUsQ0FBQyxFQUFDLE1BQU0sRUFBQztRQUN0QixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQzlCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTtJQUNyQixDQUFDO0lBRUQsa0JBQWtCLEdBQUcsQ0FBQyxFQUFDLEtBQUssRUFBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUE7Q0FDaEUsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3NoYXBlQ29tcG9uZW50LCBTaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudFwiXG5pbXBvcnQge0FuaW1hdGVkfSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHtUYWJsZUNvbnRleHR9IGZyb20gXCIuL3RhYmxlXCJcbmltcG9ydCB1c2VFdmVudEVtaXR0ZXIgZnJvbSBcInlhLXVzZS1ldmVudC1lbWl0dGVyXCJcbmltcG9ydCB7djQgYXMgdXVpZHY0fSBmcm9tIFwidXVpZFwiXG5cbmNvbnN0IFJvd0NvbnRleHQgPSBSZWFjdC5jcmVhdGVDb250ZXh0KClcblxuZXhwb3J0IHtSb3dDb250ZXh0fVxuXG5leHBvcnQgZGVmYXVsdCBSZWFjdC5tZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIFRhYmxlUm93IGV4dGVuZHMgU2hhcGVDb21wb25lbnQge1xuICBjb2x1bW5zID0ge31cbiAgY29sdW1uc0NvdW50ID0gMFxuICBpZCA9IHV1aWR2NCgpXG4gIHBvc2l0aW9uID0gbnVsbFxuXG4gIHNldHVwKCkge1xuICAgIHRoaXMudGFibGVDb250ZXh0ID0gUmVhY3QudXNlQ29udGV4dChUYWJsZUNvbnRleHQpXG4gICAgdGhpcy5yb3dDb250ZXh0ID0gUmVhY3QudXNlTWVtbygoKSA9PiAoe1xuICAgICAgcm93OiB0aGlzXG4gICAgfSksIFtdKVxuICAgIHRoaXMud2lkdGggPSBSZWFjdC51c2VNZW1vKCgpID0+IG5ldyBBbmltYXRlZC5WYWx1ZSh0aGlzLnRhYmxlQ29udGV4dC53aWR0aCB8fCAwKSwgW10pXG5cbiAgICB1c2VFdmVudEVtaXR0ZXIodGhpcy50YWJsZUNvbnRleHQuZXZlbnRzLCBcInRhYmxlLXdpZHRoLWNoYW5nZWRcIiwgdGhpcy50dC5vblRhYmxlV2lkdGhDaGFuZ2UpXG5cbiAgICBSZWFjdC51c2VNZW1vKCgpID0+IHtcbiAgICAgIGNvbnN0IHtwb3NpdGlvbn0gPSB0aGlzLnRhYmxlQ29udGV4dC50YWJsZS5vbk1vdW50Um93KHtyb3c6IHRoaXN9KVxuXG4gICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb25cbiAgICB9LCBbXSlcblxuICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICB0aGlzLnRhYmxlQ29udGV4dC50YWJsZS5vblVubW91bnRSb3coe3JvdzogdGhpc30pXG4gICAgICB9XG4gICAgfSwgW10pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2NoaWxkcmVuLCBzdHlsZSwgLi4ucmVzdFByb3BzfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCByb3dTdHlsZSA9IFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXG4gICAgICAgIHtmbGV4RGlyZWN0aW9uOiBcInJvd1wiLCB3aWR0aDogdGhpcy50dC53aWR0aH0sXG4gICAgICAgIHN0eWxlXG4gICAgICApXG4gICAgfSwgW3N0eWxlXSlcblxuICAgIHJldHVybiAoXG4gICAgICA8Um93Q29udGV4dC5Qcm92aWRlciB2YWx1ZT17dGhpcy50dC5yb3dDb250ZXh0fT5cbiAgICAgICAgPEFuaW1hdGVkLlZpZXcgc3R5bGU9e3Jvd1N0eWxlfSB7Li4ucmVzdFByb3BzfT5cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIDwvQW5pbWF0ZWQuVmlldz5cbiAgICAgIDwvUm93Q29udGV4dC5Qcm92aWRlcj5cbiAgICApXG4gIH1cblxuICBvbkNvbHVtbk1vdW50KHtjb2x1bW59KSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmNvbHVtbnNDb3VudFxuXG4gICAgdGhpcy5jb2x1bW5zQ291bnQrK1xuICAgIHRoaXMuY29sdW1uc1tjb2x1bW4uaWRdID0ge1xuICAgICAgY29sdW1uLFxuICAgICAgcG9zaXRpb25cbiAgICB9XG5cbiAgICByZXR1cm4ge3Bvc2l0aW9ufVxuICB9XG5cbiAgb25Db2x1bW5Vbm1vdW50KHtjb2x1bW59KSB7XG4gICAgZGVsZXRlIHRoaXMuY29sdW1uc1tjb2x1bW4uaWRdXG4gICAgdGhpcy5jb2x1bW5zQ291bnQtLVxuICB9XG5cbiAgb25UYWJsZVdpZHRoQ2hhbmdlID0gKHt3aWR0aH0pID0+IHRoaXMudHQud2lkdGguc2V0VmFsdWUod2lkdGgpXG59KSlcbiJdfQ==